"0","for (G  in X_genre){          "
"0",""
"0","foo2<-foo1 %>% "
"0","  filter_(paste(G, ""=="", 1))%>% "
"0","  pivot_longer(-c(id, year), names_to=""genre"", values_to=""value"") %>% "
"0","  group_by(year, genre) %>% "
"0","  summarise(n=sum(value))"
"0",""
"0","foo3<-foo2%>% filter(genre==G)%>% "
"0","  select(-genre) %>% "
"0","  rename(!!G := n) "
"0","library(zoo)"
"0",""
"0","foo4<-foo2 %>% left_join(foo3)%>% "
"0","  mutate_(paste(""d=n/"",G))%>% "
"0","  rename(d=5) %>% "
"0","  select(-3,-4) %>% "
"0","  filter(genre !=G) %>% group_by(genre)%>% "
"0","  mutate(p=rollapply(d, 3, mean, fill=0,na.rm=TRUE))"
"0",""
"0","ggplot(foo4, aes(x=year, y=reorder(genre, p)))+ "
"0","  geom_tile(aes(fill = p))+ "
"0","  scale_fill_gradient2(low =""skyblue1"", mid = ""seashell"", high = ""deeppink2"", midpoint=.1,limits=c(0,.7), name = ""Probabilité"") +"
"0","theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))+ "
"0","  labs(title = paste(""Un nouvel album de"",G, "" peut aussi être catégorisé comme...""), x=NULL, y=NULL) + "
"0","  scale_x_continuous(breaks = breaks2)"
"0",""
"0","ggsave(filename=paste0(""./images/genre10_"", G , "".jpeg""), plot=last_plot(), width = 27, height = 18, units = ""cm"")"
"0","foo5<-foo4%>%"
"0","  mutate(paste(""target=="",G))"
"0",""
"0","foo<-rbind(foo,foo5)"
"0","}"
"2","`summarise()` has grouped output by 'year'. You can override using the `.groups` argument."
"2","Joining, by = ""year"""
